{% extends 'base.html' %} {% block content %}
<style>
  .petition-card {
    border-radius: 12px;
    padding: 2px;
    background: linear-gradient(90deg, #d53369 0%, #daae51 100%);
    max-width: 600px;
    margin: 3rem auto;
  }
  .petition-surface {
    background: #111;
    border-radius: 10px;
    padding: 2rem;
    color: rgba(255, 255, 255, 0.9);
  }
  .vote-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 1.5rem;
  }
  .btn-gradient {
    background: linear-gradient(90deg, #d53369 0%, #daae51 50%, #6a11cb 100%);
    border: none;
    color: white;
    padding: 0.6rem 1.25rem;
    border-radius: 20px;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.3s ease;
  }
  .btn-gradient:hover {
    opacity: 0.85;
  }
  .vote-counts {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 0.5rem;
  }
  .badge-yes {
    background: #4caf50;
    color: #fff;
    padding: 0.35rem 1.1rem;
    border-radius: 999px;
    font-weight: 700;
    font-size: 1.08rem;
    display: inline-block;
    letter-spacing: 0.02em;
    box-shadow: none;
    border: none;
    cursor: default;
  }
  .badge-no {
    background: #e53935;
    color: #fff;
    padding: 0.35rem 1.1rem;
    border-radius: 999px;
    font-weight: 700;
    font-size: 1.08rem;
    display: inline-block;
    letter-spacing: 0.02em;
    box-shadow: none;
    border: none;
    cursor: default;
  }
  .action-buttons {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 1.5rem;
  }
  #edit-vote {
    display: none;
    margin-top: 1rem;
    justify-content: center;
    gap: 1rem;
  }
  .created-by {
    color: #b44aff;
    font-weight: 600;
  }
</style>

<div class="petition-card">
  <div class="petition-surface">
    {% if messages %} 
      <div id="flash-messages">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}" role="alert">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
    <h2 style="color:#ffd16d; font-weight: 900;">{{ petition.title }}</h2>
    <p class="created-by">
      Created by {{ petition.created_by.username }}
    </p>
    <hr />
    <p>{{ petition.description }}</p>

    <h4 class="mt-4">Vote Count:</h4>
    <div class="vote-counts">
      <span class="badge-yes">{{ votes_yes }}</span>
      <span style="color: #999; font-weight: 500; align-self: center">Yes</span>
      <span class="badge-no">{{ votes_no }}</span>
      <span style="color: #999; font-weight: 500; align-self: center">No</span>
    </div>

    {% if user.is_authenticated %} {% if not user_vote %}
    <div class="vote-buttons">
      <form method="POST" action="{% url 'movies.vote_petition' petition.id %}">
        {% csrf_token %}
        <input type="hidden" name="vote" value="yes" />
        <button type="submit" class="btn-gradient">Yes</button>
      </form>
      <form method="POST" action="{% url 'movies.vote_petition' petition.id %}">
        {% csrf_token %}
        <input type="hidden" name="vote" value="no" />
        <button type="submit" class="btn-gradient">No</button>
      </form>
    </div>
    {% else %} {% if user_vote %}
    <div class="alert alert-info mt-3">
      You voted <strong>{{ user_vote|capfirst }}</strong> on this petition.
    </div>
    <div id="edit-vote">
      <form method="POST" action="{% url 'movies.vote_petition' petition.id %}">
        {% csrf_token %}
        <input type="hidden" name="vote" value="yes" />
        <button type="submit" class="btn-gradient">Yes</button>
      </form>
      <form method="POST" action="{% url 'movies.vote_petition' petition.id %}">
        {% csrf_token %}
        <input type="hidden" name="vote" value="no" />
        <button type="submit" class="btn-gradient">No</button>
      </form>
    </div>
    <div class="action-buttons">
      <button
        class="btn-gradient"
        onclick="document.getElementById('edit-vote').style.display='flex'"
      >
        Edit Vote
      </button>
      <a href="{% url 'movies.petition_list' %}" class="btn-gradient"
        >Back to Petitions</a
      >
    </div>
    {% endif %} {% endif %} {% else %}
    <p class="mt-3">
      Please <a href="{% url 'accounts.login' %}" style="text-decoration: none;">login</a> to vote.
    </p>
    {% endif %}
    </div>
  </div>
</div>
<script>
  setTimeout(() => {
    const flash = document.getElementById('flash-messages');
    if (flash) {
      flash.style.transition = "opacity 0.5s ease";
      flash.style.opacity = "0";
      setTimeout(() => flash.remove(), 500);
    }
  }, 1500); // 3 seconds
</script>
{% endblock %}
